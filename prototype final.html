<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bakery Hub 3.0 â€“ ì§ì› í¬í„¸</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --blue:#2563eb; --surface:#ffffff; --bg:#f6f7fb; --text:#0f172a; --muted:#64748b;
    --border:#e5e7eb; --shadow:0 8px 24px rgba(2,29,61,.05);
    --red:#ef4444; --amber:#f59e0b; --yellow:#eab308; --green:#16a34a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:"Pretendard",system-ui,Segoe UI,Roboto,Arial; color:var(--text); background:var(--bg)}
  header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.9);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  .wrap{max-width:1200px;margin:0 auto;padding:16px}
  nav{display:flex;gap:8px;flex-wrap:wrap}
  nav a{padding:10px 14px;border-radius:12px;color:#334155;text-decoration:none}
  nav a.active{background:#e8f0ff;color:var(--blue);font-weight:700}
  .spacer{flex:1}
  .flex{display:flex;align-items:center;gap:10px}
  .btn{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
  .btn.primary{background:var(--blue);border-color:var(--blue);color:#fff}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
  .title{font-size:18px;font-weight:700;margin:0 0 8px}
  .subtle{color:var(--muted)}
  .page{display:none}.page.active{display:block}
  .grid{display:grid;gap:16px}
  .g-3{grid-template-columns:repeat(3,1fr)}
  @media (max-width:900px){.g-3{grid-template-columns:1fr}}
  .kpi{display:flex;flex-direction:column;gap:8px}
  .badge{display:inline-block;border-radius:999px;padding:6px 10px;font-size:12px}
  .danger{background:#fee2e2;color:#991b1b}
  .warn{background:#fff7ed;color:#9a3412}
  .note{background:#fef9c3;color:#854d0e}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-top:1px solid var(--border);text-align:left}
  th{color:var(--muted);font-size:13px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  .input, select, textarea{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff}
  dialog{border:none;border-radius:16px;box-shadow:var(--shadow);padding:16px;width:min(560px,92vw)}
  .field{margin-bottom:10px}.field label{display:block;margin-bottom:4px;color:#475569;font-size:13px}
  .toasts{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:8px;z-index:50}
  .toast{background:#0f172a;color:#fff;padding:10px 12px;border-radius:12px;opacity:.96}
</style>
</head>
<body>
<header>
  <div class="wrap flex">
    <strong style="font-size:20px">ğŸª Bakery Hub</strong>
    <nav id="nav" class="flex">
      <a href="#" data-page="home" class="active">í™ˆ</a>
      <a href="#" data-page="notice">ê³µì§€ì‚¬í•­</a>
      <a href="#" data-page="inventory">ì¬ê³ ê´€ë¦¬</a>
      <a href="#" data-page="attendance">ì¶œí‡´ê·¼</a>
      <a href="#" data-page="reservations">ì˜ˆì•½</a>
      <a href="#" data-page="deliveries">ë°°ë‹¬</a>
    </nav>
    <div class="spacer"></div>
    <button class="btn primary" data-go="inventory" id="quickAdd">ì¬ê³  ë“±ë¡</button>
  </div>
</header>

<main class="wrap" style="padding-block:18px">
  <!-- HOME -->
  <section id="home" class="page active">
    <div class="card" style="height:220px;display:flex;align-items:center;justify-content:center">
      <div class="subtle">ë§¤ì¥ ì´ë¯¸ì§€ ë°°ë„ˆ(ì°¨í›„ êµì²´ ê°€ëŠ¥)</div>
    </div>
    <div class="grid g-3" style="margin-top:16px">
      <div class="card">
        <h3 class="title">ì˜¤ëŠ˜ì˜ ê³µì§€</h3>
        <div id="homeNotice" class="subtle">ê³µì§€ì‚¬í•­ í˜ì´ì§€ì—ì„œ ê³µì§€ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”.</div>
      </div>
      <div class="card">
        <h3 class="title">ë¹¼ì•¼ í•˜ëŠ” ë¹µ</h3>
        <ul id="homeToday" class="subtle" style="padding-left:18px"></ul>
      </div>
      <div class="card">
        <h3 class="title">ì„ë°•(D-1~D-2)</h3>
        <ul id="homeSoon" class="subtle" style="padding-left:18px"></ul>
      </div>
    </div>
  </section>

  <!-- NOTICE -->
  <section id="notice" class="page">
    <div class="card">
      <div class="flex" style="justify-content:space-between">
        <h3 class="title">ê³µì§€ì‚¬í•­</h3>
        <div class="toolbar">
          <select id="noticeFilter" class="input">
            <option value="all">ì „ì²´</option>
            <option value="important">ì¤‘ìš”</option>
            <option value="normal">ì¼ë°˜</option>
            <option value="unread">ë¯¸í™•ì¸</option>
          </select>
          <button class="btn primary" id="openNoticeAdd">ê³µì§€ ë“±ë¡</button>
        </div>
      </div>
      <div id="noticeList" style="margin-top:12px"></div>
    </div>
  </section>

  <!-- INVENTORY -->
  <section id="inventory" class="page">
    <!-- ìƒë‹¨ 3êµ¬ì—­: D-DAY, D-1, D-2 -->
    <div class="grid g-3">
      <div class="card kpi">
        <h3 class="title">D-DAY (ì˜¤ëŠ˜ ë¹¼ê¸°)</h3>
        <div id="boxD0" class="subtle">ì—†ìŒ</div>
      </div>
      <div class="card kpi">
        <h3 class="title">D-1 (ë‚´ì¼ ì„ë°•)</h3>
        <div id="boxD1" class="subtle">ì—†ìŒ</div>
      </div>
      <div class="card kpi">
        <h3 class="title">D-2 (ëª¨ë ˆ ì„ë°•)</h3>
        <div id="boxD2" class="subtle">ì—†ìŒ</div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <h3 class="title">ì¬ê³  ëª©ë¡</h3>
        <div class="toolbar">
          <input id="search" class="input" placeholder="í’ˆëª©/ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰">
          <select id="catFilter" class="input"><option value="all">ì¹´í…Œê³ ë¦¬: ì „ì²´</option></select>
          <button class="btn primary" id="openAdd">ì¬ê³  ë“±ë¡</button>
        </div>
      </div>
      <div style="overflow:auto;margin-top:8px">
        <table id="table">
          <thead>
            <tr><th>í’ˆëª©</th><th>ì¹´í…Œê³ ë¦¬</th><th>ë‚¨ì€ ì¬ê³ </th><th>ìµœì†Œ ìˆ˜ëŸ‰</th><th>ìœ í†µê¸°í•œ</th><th>D-Day</th><th>ê´€ë¦¬</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="subtle" id="countLabel" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- ATTENDANCE -->
  <section id="attendance" class="page">
    <div class="card">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <h3 class="title">ì¶œí‡´ê·¼ ê¸°ë¡</h3>
        <div class="toolbar">
          <input id="aName" class="input" placeholder="ì§ì›ëª…">
          <button class="btn primary" id="btnClockIn">ì¶œê·¼</button>
          <button class="btn" id="btnClockOut">í‡´ê·¼</button>
        </div>
      </div>
      <div class="grid g-3" style="margin-top:12px">
        <div class="card"><strong>ì˜¤ëŠ˜</strong><div id="attToday" class="subtle" style="margin-top:6px">ê¸°ë¡ ì—†ìŒ</div></div>
        <div class="card"><strong>ìµœê·¼ 5ê°œ</strong><div id="attRecent" class="subtle" style="margin-top:6px">ê¸°ë¡ ì—†ìŒ</div></div>
        <div class="card"><strong>ì „ì²´</strong><div id="attAll" class="subtle" style="margin-top:6px">0ê±´</div></div>
      </div>
    </div>
  </section>

  <!-- RESERVATIONS -->
  <section id="reservations" class="page">
    <div class="card">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <h3 class="title">ì˜ˆì•½ ëª©ë¡</h3>
        <button class="btn primary" id="openResv">ì˜ˆì•½ ì¶”ê°€</button>
      </div>
      <div style="overflow:auto;margin-top:8px">
        <table>
          <thead><tr><th>ì´ë¦„</th><th>ì¸ì›</th><th>ì˜ˆì•½ì‹œê°„</th><th>ì—°ë½ì²˜</th><th>ìš”ì²­ì‚¬í•­</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
          <tbody id="resvTable"></tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- DELIVERIES -->
  <section id="deliveries" class="page">
    <div class="card">
      <div class="flex" style="justify-content:space-between;align-items:center">
        <h3 class="title">ë°°ë‹¬ ëª©ë¡</h3>
        <button class="btn primary" id="openDeli">ë°°ë‹¬ ì¶”ê°€</button>
      </div>
      <div style="overflow:auto;margin-top:8px">
        <table>
          <thead><tr><th>ê³ ê°ëª…</th><th>ì£¼ì†Œ</th><th>ì—°ë½ì²˜</th><th>ë‚´ìš©</th><th>ìƒíƒœ</th><th>ê´€ë¦¬</th></tr></thead>
          <tbody id="deliTable"></tbody>
        </table>
      </div>
    </div>
  </section>
</main>

<footer class="wrap" style="padding:18px;color:#94a3b8;font-size:13px">Â© 2025 Bakery Hub</footer>

<!-- ê³µì§€ ëª¨ë‹¬ -->
<dialog id="noticeModal">
  <form method="dialog" id="noticeForm">
    <h3 class="title">ê³µì§€ ë“±ë¡</h3>
    <div class="field"><label>ì œëª©</label><input id="nTitle" class="input" required></div>
    <div class="field"><label>ë‚´ìš©</label><textarea id="nBody" class="input" rows="3"></textarea></div>
    <div class="field"><label>ë¶„ë¥˜</label>
      <select id="nType" class="input"><option value="normal">ì¼ë°˜</option><option value="important">ì¤‘ìš”</option></select>
    </div>
    <div class="flex" style="justify-content:flex-end;margin-top:10px">
      <button class="btn" type="button" id="cancelNotice">ì·¨ì†Œ</button>
      <button class="btn primary" type="submit">ë“±ë¡</button>
    </div>
  </form>
</dialog>

<!-- ì¬ê³  ëª¨ë‹¬ -->
<dialog id="itemModal">
  <form method="dialog" id="itemForm">
    <h3 class="title" id="itemTitle">ì¬ê³  ë“±ë¡</h3>
    <div class="grid g-3">
      <div class="field"><label>í’ˆëª©ëª…</label><input id="fName" class="input" required></div>
      <div class="field"><label>ì¹´í…Œê³ ë¦¬</label><input id="fCat" class="input" placeholder="ë¹µ/ë””ì €íŠ¸ ë“±"></div>
      <div class="field"><label>ìˆ˜ëŸ‰</label><input id="fQty" type="number" min="0" value="10" class="input"></div>
      <div class="field"><label>ìµœì†Œ ìˆ˜ëŸ‰</label><input id="fMin" type="number" min="0" value="15" class="input"></div>
      <div class="field"><label>ìœ í†µê¸°í•œ</label><input id="fExp" type="date" class="input" required></div>
      <input type="hidden" id="fIndex">
    </div>
    <div class="flex" style="justify-content:flex-end;margin-top:10px">
      <button class="btn" type="button" id="cancelItem">ì·¨ì†Œ</button>
      <button class="btn primary" type="submit">ì €ì¥</button>
    </div>
  </form>
</dialog>

<!-- ì˜ˆì•½ ëª¨ë‹¬ -->
<dialog id="resvModal">
  <form method="dialog" id="resvForm">
    <h3 class="title" id="resvTitle">ì˜ˆì•½ ì¶”ê°€</h3>
    <div class="grid g-3">
      <div class="field"><label>ì´ë¦„</label><input id="rName" class="input" required></div>
      <div class="field"><label>ì¸ì›</label><input id="rPeople" type="number" min="1" value="2" class="input"></div>
      <div class="field"><label>ì˜ˆì•½ ì‹œê°„</label><input id="rTime" type="datetime-local" class="input" required></div>
      <div class="field" style="grid-column:1/-1"><label>ì—°ë½ì²˜</label><input id="rPhone" class="input"></div>
      <div class="field" style="grid-column:1/-1"><label>ìš”ì²­ì‚¬í•­</label><textarea id="rNote" class="input" rows="2"></textarea></div>
      <input type="hidden" id="rIndex">
    </div>
    <div class="flex" style="justify-content:flex-end;margin-top:10px">
      <button class="btn" type="button" id="cancelResv">ì·¨ì†Œ</button>
      <button class="btn primary" type="submit">ì €ì¥</button>
    </div>
  </form>
</dialog>

<!-- ë°°ë‹¬ ëª¨ë‹¬ -->
<dialog id="deliModal">
  <form method="dialog" id="deliForm">
    <h3 class="title" id="deliTitle">ë°°ë‹¬ ì¶”ê°€</h3>
    <div class="grid g-3">
      <div class="field"><label>ê³ ê°ëª…</label><input id="dName" class="input" required></div>
      <div class="field"><label>ì—°ë½ì²˜</label><input id="dPhone" class="input"></div>
      <div class="field" style="grid-column:1/-1"><label>ì£¼ì†Œ</label><input id="dAddr" class="input" required></div>
      <div class="field" style="grid-column:1/-1"><label>ì£¼ë¬¸ ë‚´ì—­</label><textarea id="dItems" class="input" rows="2" placeholder="ì˜ˆ: í¬ë¡œì™€ìƒ3, ì‹ë¹µ1"></textarea></div>
      <div class="field"><label>ìƒíƒœ</label>
        <select id="dStatus" class="input">
          <option>ì¤€ë¹„ì¤‘</option><option>ë°°ë‹¬ì¤‘</option><option>ì™„ë£Œ</option>
        </select>
      </div>
      <input type="hidden" id="dIndex">
    </div>
    <div class="flex" style="justify-content:flex-end;margin-top:10px">
      <button class="btn" type="button" id="cancelDeli">ì·¨ì†Œ</button>
      <button class="btn primary" type="submit">ì €ì¥</button>
    </div>
  </form>
</dialog>

<div class="toasts" id="toasts"></div>

<script>
// ---------- ìœ í‹¸ ----------
const $ = sel => document.querySelector(sel);
const $$ = sel => [...document.querySelectorAll(sel)];
const toastBox = $("#toasts");
const toast = (msg)=>{ const el=document.createElement('div'); el.className='toast'; el.textContent=msg; toastBox.appendChild(el); setTimeout(()=>el.style.opacity='0',2200); setTimeout(()=>el.remove(),2700); };
const pad = n => String(n).padStart(2,'0');
const fmtDate = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
const fmtTime = d => `${pad(d.getHours())}:${pad(d.getMinutes())}`;
const todayStr = fmtDate(new Date());
const dday = exp => Math.ceil((new Date(exp) - new Date(todayStr))/86400000);
const store = {
  get:(k,f)=>{ try{ return JSON.parse(localStorage.getItem(k)) ?? f; }catch{ return f; } },
  set:(k,v)=> localStorage.setItem(k, JSON.stringify(v))
};

// ---------- ë¼ìš°íŒ… (í´ë¦­ ë¬¸ì œ í•´ê²°: ì´ë²¤íŠ¸ ìœ„ì„) ----------
function showPage(id){
  $$(".page").forEach(p=>p.classList.remove("active"));
  $("#"+id).classList.add("active");
  $$("#nav a").forEach(a=>a.classList.toggle("active", a.dataset.page===id));
}
$("#nav").addEventListener("click",(e)=>{
  const a = e.target.closest("a[data-page]"); if(!a) return;
  e.preventDefault(); showPage(a.dataset.page);
});
$("#quickAdd").addEventListener("click", ()=>{
  showPage('inventory');
  openItemModal(); // ë°”ë¡œ ì¬ê³  ë“±ë¡ ëª¨ë‹¬
});

// ---------- ì´ˆê¸° ë°ì´í„° ----------
let notices = store.get('notices', [
  {id:Date.now()-1, title:'ë‚´ì¼ 9ì‹œ ì¬ê³  ì ê²€', body:'ì˜¤í”ˆ ì „ ì„ë°•í’ˆ ì •ë¦¬', type:'important', read:false}
]);
let items = store.get('items', [
  {name:'í¬ë¡œì™€ìƒ',cat:'ë¹µ',qty:26,min:15,exp:fmtDate(new Date(Date.now()+86400000))},
  {name:'í¬ë¦¼ë¹µ',cat:'ë¹µ',qty:12,min:20,exp:fmtDate(new Date())},
  {name:'ì‹ë¹µ',cat:'ì‹ì‚¬ë¹µ',qty:40,min:25,exp:fmtDate(new Date(Date.now()+86400000*3))},
  {name:'ì´ˆì½”ë¨¸í•€',cat:'ë””ì €íŠ¸',qty:8,min:15,exp:fmtDate(new Date())},
  {name:'ìŠ¤ì½˜',cat:'ë””ì €íŠ¸',qty:5,min:10,exp:fmtDate(new Date(Date.now()+86400000*2))}
]);
let attendance = store.get('attendance', []);  // {name,type,at}
let reservations = store.get('reservations', []);
let deliveries = store.get('deliveries', []);

// ---------- HOME ----------
function renderHome(){
  const n = notices[0];
  $("#homeNotice").innerHTML = n ? `<strong>${n.type==='important'?'[ì¤‘ìš”] ':''}${n.title}</strong><br><span class="subtle">${n.body||''}</span>` : 'ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.';
  const d0 = items.filter(i=>dday(i.exp)<=0);
  const soon = items.filter(i=>{const d=dday(i.exp);return d>0&&d<=2;});
  $("#homeToday").innerHTML = d0.length? d0.map(i=>`<li>${i.name} (${i.qty}ê°œ)</li>`).join('') : 'ì—†ìŒ';
  $("#homeSoon").innerHTML = soon.length? soon.map(i=>`<li>${i.name} (D-${dday(i.exp)})</li>`).join('') : 'ì—†ìŒ';
}

// ---------- NOTICE ----------
const noticeModal = $("#noticeModal");
$("#openNoticeAdd").addEventListener("click", ()=>{ $("#nTitle").value=''; $("#nBody").value=''; $("#nType").value='normal'; noticeModal.showModal(); });
$("#cancelNotice").addEventListener("click", ()=> noticeModal.close());
$("#noticeForm").addEventListener("submit",(e)=>{
  e.preventDefault();
  notices.unshift({ id:Date.now(), title:$("#nTitle").value.trim()||'ì œëª© ì—†ìŒ', body:$("#nBody").value.trim()||'', type:$("#nType").value, read:false });
  store.set('notices', notices); noticeModal.close(); renderNotice(); renderHome(); toast('ê³µì§€ ë“±ë¡ ì™„ë£Œ');
});
$("#noticeFilter").addEventListener("change", renderNotice);
function renderNotice(){
  const f = $("#noticeFilter").value;
  let data = [...notices];
  if (f==='important') data = data.filter(n=>n.type==='important');
  if (f==='normal')    data = data.filter(n=>n.type==='normal');
  if (f==='unread')    data = data.filter(n=>!n.read);
  $("#noticeList").innerHTML = data.length ? data.map(n=>`
    <div class="card" style="margin-bottom:8px">
      <div class="flex" style="justify-content:space-between">
        <div>
          <div><strong>${n.type==='important'?'[ì¤‘ìš”] ':''}${n.title}</strong></div>
          <div class="subtle">${n.body||''}</div>
        </div>
        <div class="flex">
          <label class="subtle" style="display:flex;align-items:center;gap:6px">
            <input type="checkbox" ${n.read?'checked':''} onchange="toggleNotice(${n.id}, this.checked)"> í™•ì¸
          </label>
          <button class="btn" onclick="delNotice(${n.id})">ì‚­ì œ</button>
        </div>
      </div>
    </div>
  `).join('') : `<div class="subtle">í‘œì‹œí•  ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
}
window.toggleNotice=(id,v)=>{ const t=notices.find(n=>n.id===id); if(t){ t.read=v; store.set('notices',notices); renderHome(); } };
window.delNotice=(id)=>{ notices = notices.filter(n=>n.id!==id); store.set('notices',notices); renderNotice(); renderHome(); };

// ---------- INVENTORY (D-DAY/D-1/D-2 ìƒë‹¨ ì¹´ë“œ + ëª©ë¡) ----------
const itemModal = $("#itemModal");
$("#openAdd").addEventListener("click", ()=> openItemModal());
$("#cancelItem").addEventListener("click", ()=> itemModal.close());
$("#itemForm").addEventListener("submit",(e)=>{
  e.preventDefault();
  const idx = $("#fIndex").value;
  const obj = {
    name:$("#fName").value.trim()||'ìƒˆ í’ˆëª©',
    cat: $("#fCat").value.trim()||'ê¸°íƒ€',
    qty: Number($("#fQty").value)||0,
    min: Number($("#fMin").value)||0,
    exp: $("#fExp").value
  };
  if (idx==='') items.unshift(obj); else items[idx]=obj;
  store.set('items', items); itemModal.close(); renderInventory(); renderHome(); toast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
});
const search = $("#search"), catFilter = $("#catFilter");
search.addEventListener("input", renderInventory);
catFilter.addEventListener("change", renderInventory);

function openItemModal(idx){
  $("#itemTitle").textContent = idx==null ? 'ì¬ê³  ë“±ë¡' : 'ì¬ê³  ìˆ˜ì •';
  $("#fIndex").value = idx==null ? '' : idx;
  if (idx==null){ $("#fName").value=''; $("#fCat").value=''; $("#fQty").value=10; $("#fMin").value=15; $("#fExp").value=fmtDate(new Date(Date.now()+86400000*3)); }
  else { const i=items[idx]; $("#fName").value=i.name; $("#fCat").value=i.cat; $("#fQty").value=i.qty; $("#fMin").value=i.min; $("#fExp").value=i.exp; }
  itemModal.showModal();
}
window.delItem = (idx)=>{ if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return; const nm=items[idx].name; items.splice(idx,1); store.set('items',items); renderInventory(); renderHome(); toast(`ì‚­ì œë¨: ${nm}`); };

function refreshCatFilter(){
  const set = new Set(items.map(i=>i.cat));
  const prev = catFilter.value;
  catFilter.innerHTML = `<option value="all">ì¹´í…Œê³ ë¦¬: ì „ì²´</option>` + [...set].map(c=>`<option value="${c}">${c}</option>`).join('');
  if ([...set,'all'].includes(prev)) catFilter.value = prev;
}
function filteredItems(){
  const kw = search.value.trim().toLowerCase();
  let data = items.filter(i => i.name.toLowerCase().includes(kw) || i.cat.toLowerCase().includes(kw));
  if (catFilter.value!=='all') data = data.filter(i=>i.cat===catFilter.value);
  return data;
}
function renderInventory(){
  refreshCatFilter();
  const data = filteredItems();

  // ìƒë‹¨ 3ë°•ìŠ¤
  const d0 = data.filter(i=>dday(i.exp)<=0);
  const d1 = data.filter(i=>dday(i.exp)===1);
  const d2 = data.filter(i=>dday(i.exp)===2);
  const fmtList = arr => arr.length? `<ul style="margin:0;padding-left:18px">${arr.map(i=>`<li>${i.name} (${i.qty}ê°œ)</li>`).join('')}</ul>` : 'ì—†ìŒ';
  $("#boxD0").innerHTML = fmtList(d0);
  $("#boxD1").innerHTML = fmtList(d1);
  $("#boxD2").innerHTML = fmtList(d2);

  // í…Œì´ë¸”
  $("#table tbody").innerHTML = data.map(i=>{
    const d = dday(i.exp), tone = d<=0?'danger':d===1?'warn':'note', color = tone==='danger'?'#b91c1c':tone==='warn'?'#9a3412':'#854d0e';
    const idx = items.indexOf(i);
    return `<tr style="color:${color}">
      <td>${i.name}</td><td>${i.cat}</td><td>${i.qty}</td><td>${i.min}</td><td>${i.exp}</td>
      <td><span class="badge ${tone}">${d<=0?'D-DAY':`D-${d}`}</span></td>
      <td><button class="btn" onclick="openItemModal(${idx})">ìˆ˜ì •</button> <button class="btn" onclick="delItem(${idx})">ì‚­ì œ</button></td>
    </tr>`;
  }).join('');
  $("#countLabel").textContent = `${data.length}ê°œ í•­ëª©`;
}

// ---------- ATTENDANCE ----------
$("#btnClockIn").addEventListener("click", ()=> clock('ì¶œê·¼'));
$("#btnClockOut").addEventListener("click", ()=> clock('í‡´ê·¼'));
function clock(type){
  const name = $("#aName").value.trim();
  if (!name){ toast('ì§ì›ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  attendance.unshift({name, type, at:new Date().toISOString()});
  store.set('attendance', attendance);
  renderAttendance(); toast(`${name} ${type} ê¸°ë¡`);
}
window.delAtt = (i)=>{ attendance.splice(i,1); store.set('attendance',attendance); renderAttendance(); };
function renderAttendance(){
  const today = attendance.filter(a=> fmtDate(new Date(a.at))===todayStr );
  $("#attToday").innerHTML = today.length? today.map(a=>`${fmtTime(new Date(a.at))} Â· ${a.name} Â· ${a.type}`).join('<br>') : 'ê¸°ë¡ ì—†ìŒ';
  $("#attRecent").innerHTML = attendance.slice(0,5).map(a=>`${fmtDate(new Date(a.at))} ${fmtTime(new Date(a.at))} Â· ${a.name} Â· ${a.type} <button class="btn" onclick="delAtt(${attendance.indexOf(a)})">ì‚­ì œ</button>`).join('<br>') || 'ê¸°ë¡ ì—†ìŒ';
  $("#attAll").textContent = `${attendance.length}ê±´`;
}

// ---------- RESERVATIONS ----------
const resvModal = $("#resvModal");
$("#openResv").addEventListener("click", ()=> openResvModal());
$("#cancelResv").addEventListener("click", ()=> resvModal.close());
$("#resvForm").addEventListener("submit",(e)=>{
  e.preventDefault();
  const idx = $("#rIndex").value;
  const obj = {
    name: $("#rName").value.trim(),
    people: Number($("#rPeople").value)||1,
    timeISO: $("#rTime").value,
    phone: $("#rPhone").value.trim(),
    note: $("#rNote").value.trim(),
    status: 'í™•ì •',
    id: idx===''? Date.now(): reservations[idx].id
  };
  if (idx==='') reservations.unshift(obj); else reservations[idx]=obj;
  store.set('reservations',reservations); resvModal.close(); renderReservations(); toast('ì˜ˆì•½ ì €ì¥');
});
function openResvModal(idx){
  $("#resvTitle").textContent = idx==null ? 'ì˜ˆì•½ ì¶”ê°€' : 'ì˜ˆì•½ ìˆ˜ì •';
  $("#rIndex").value = idx==null ? '' : idx;
  if (idx==null){ $("#rName").value=''; $("#rPeople").value=2; $("#rTime").value=''; $("#rPhone").value=''; $("#rNote").value=''; }
  else { const r=reservations[idx]; $("#rName").value=r.name; $("#rPeople").value=r.people; $("#rTime").value=r.timeISO; $("#rPhone").value=r.phone; $("#rNote").value=r.note; }
  resvModal.showModal();
}
window.setResvStatus=(i,v)=>{ reservations[i].status=v; store.set('reservations',reservations); renderReservations(); };
window.delResv=(i)=>{ if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return; reservations.splice(i,1); store.set('reservations',reservations); renderReservations(); };
const fmtDT = iso => { const d=new Date(iso); return `${fmtDate(d)} ${fmtTime(d)}`; };
function renderReservations(){
  $("#resvTable").innerHTML = reservations.length ? reservations.map((r,i)=>`
    <tr>
      <td>${r.name}</td><td>${r.people}</td><td>${fmtDT(r.timeISO)}</td><td>${r.phone||'-'}</td><td>${r.note||'-'}</td>
      <td>
        <select class="input" onchange="setResvStatus(${i},this.value)">
          <option ${r.status==='í™•ì •'?'selected':''}>í™•ì •</option>
          <option ${r.status==='ëŒ€ê¸°'?'selected':''}>ëŒ€ê¸°</option>
          <option ${r.status==='ì·¨ì†Œ'?'selected':''}>ì·¨ì†Œ</option>
          <option ${r.status==='ë°©ë¬¸ì™„ë£Œ'?'selected':''}>ë°©ë¬¸ì™„ë£Œ</option>
        </select>
      </td>
      <td><button class="btn" onclick="openResvModal(${i})">ìˆ˜ì •</button> <button class="btn" onclick="delResv(${i})">ì‚­ì œ</button></td>
    </tr>
  `).join('') : `<tr><td colspan="7" class="subtle">ì˜ˆì•½ ì—†ìŒ</td></tr>`;
}

// ---------- DELIVERIES ----------
const deliModal = $("#deliModal");
$("#openDeli").addEventListener("click", ()=> openDeliModal());
$("#cancelDeli").addEventListener("click", ()=> deliModal.close());
$("#deliForm").addEventListener("submit",(e)=>{
  e.preventDefault();
  const idx = $("#dIndex").value;
  const obj = {
    name: $("#dName").value.trim(),
    phone: $("#dPhone").value.trim(),
    addr: $("#dAddr").value.trim(),
    items: $("#dItems").value.trim(),
    status: $("#dStatus").value,
    id: idx===''? Date.now(): deliveries[idx].id
  };
  if (idx==='') deliveries.unshift(obj); else deliveries[idx]=obj;
  store.set('deliveries',deliveries); deliModal.close(); renderDeliveries(); toast('ë°°ë‹¬ ì €ì¥');
});
function openDeliModal(idx){
  $("#deliTitle").textContent = idx==null ? 'ë°°ë‹¬ ì¶”ê°€' : 'ë°°ë‹¬ ìˆ˜ì •';
  $("#dIndex").value = idx==null ? '' : idx;
  if (idx==null){ $("#dName").value=''; $("#dPhone").value=''; $("#dAddr").value=''; $("#dItems").value=''; $("#dStatus").value='ì¤€ë¹„ì¤‘'; }
  else { const d=deliveries[idx]; $("#dName").value=d.name; $("#dPhone").value=d.phone; $("#dAddr").value=d.addr; $("#dItems").value=d.items; $("#dStatus").value=d.status; }
  deliModal.showModal();
}
window.setDeliStatus=(i,v)=>{ deliveries[i].status=v; store.set('deliveries',deliveries); renderDeliveries(); };
window.delDeli=(i)=>{ if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return; deliveries.splice(i,1); store.set('deliveries',deliveries); renderDeliveries(); };
function renderDeliveries(){
  $("#deliTable").innerHTML = deliveries.length ? deliveries.map((d,i)=>`
    <tr>
      <td>${d.name}</td><td>${d.addr}</td><td>${d.phone||'-'}</td><td>${d.items||'-'}</td>
      <td>
        <select class="input" onchange="setDeliStatus(${i},this.value)">
          <option ${d.status==='ì¤€ë¹„ì¤‘'?'selected':''}>ì¤€ë¹„ì¤‘</option>
          <option ${d.status==='ë°°ë‹¬ì¤‘'?'selected':''}>ë°°ë‹¬ì¤‘</option>
          <option ${d.status==='ì™„ë£Œ'?'selected':''}>ì™„ë£Œ</option>
        </select>
      </td>
      <td><button class="btn" onclick="openDeliModal(${i})">ìˆ˜ì •</button> <button class="btn" onclick="delDeli(${i})">ì‚­ì œ</button></td>
    </tr>
  `).join('') : `<tr><td colspan="6" class="subtle">ë°°ë‹¬ ì—†ìŒ</td></tr>`;
}

// ---------- ì´ˆê¸° ë Œë” ----------
function boot(){
  renderHome();
  renderNotice();
  renderInventory();
  renderAttendance();
  renderReservations();
  renderDeliveries();
}
boot();
</script>
</body>
</html>
